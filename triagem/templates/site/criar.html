{% load static %}
<!DOCTYPE html>
<html lang="pt-br">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Triagem</title>
    <link rel="stylesheet" href="{% static 'front/css/base.css' %}?v=2">
    <link rel="stylesheet" href="{% static 'front/css/criar.css' %}?v=3">
</head>
<body>
{% if user.tipo_usuario != 'MEDICO' %}
<header>
    <a href="{% url 'hosp:index' %}"><h1>MedTriagem</h1></a>
    <nav class="menu-links">
        <a href="{% url 'hosp:index' %}"><p>Home</p></a>
        <!--<a href="{% url 'hosp:dashboard' %}">Dashboard</a>-->
        <a href="{% url 'hosp:criar' %}"><p>Triagem</p></a>
        <a href="{% url 'hosp:listar' %}"><p>Pacientes</p></a>
        <a class="nav-link" href="{% url 'hosp:lista_feedback' %}">Feedbacks</a>
        {% if user.is_superuser or user.tipo_usuario == 'ADMIN' %}
            <a href="{% url 'hosp:painel_gestao' %}">Painel de Gestão</a>
        {% endif %}
    </nav>
    <div class="entrar">
        <a href="{% url 'hosp:perfil' %}" class="btn-entrar">Perfil</a>
    </div>
</header>

<main class="triagem-container">
    <h2>Avaliação de Triagem</h2>
    <form class="form-triagem" action="{% url 'hosp:criar' %}" method="post">
        {% csrf_token %}
        <div class="form-section-wrapper">
            <section class="form-box">
                <h2>Dados do Paciente</h2>
                <label for="{{ form.nome.id_for_label }}">Nome:</label>
                {{ form.nome }}
                <div class="form-row">
                    <div>
                        <label for="{{ form.data_nascimento.id_for_label }}">Data de Nascimento:</label>
                        {{ form.data_nascimento }}
                    </div>
                    <div>
                        <label for="{{ form.sexo.id_for_label }}">Gênero:</label>
                        {{ form.sexo }}
                    </div>
                </div>
                <label for="{{ form.cpf.id_for_label }}">CPF:</label>
                {{ form.cpf }}
                <label for="{{ form.convenio.id_for_label }}">Convênio:</label>
                {{ form.convenio }}
                <!--<label for="{{ form.hora_chegada.id_for_label }}">Horário de Chegada:</label>
                {{ form.hora_chegada }}-->
                {% if form.errors %}
                    <div class="form-errors-container">
                        <h3>Por favor, corrija os erros abaixo:</h3>
                        <ul>
                            {% for field in form %}
                                {% for error in field.errors %}
                                    <li><strong>{{ field.label }}:</strong> {{ error }}</li>
                                {% endfor %}
                            {% endfor %}
                            
                            {% for error in form.non_field_errors %}
                                <li>{{ error }}</li>
                            {% endfor %}
                        </ul>
                    </div>
                {% endif %}
            </section>
            <section class="form-box">
                <h2>Avaliação Clínica</h2>

                <div class="tabs">
                    <button type="button" class="tab-button active" id="tab-btn-sinais" onclick="openTab(event, 'sinais')">Sinais Vitais</button>
                    <button type="button" class="tab-button" id="tab-btn-queixa" onclick="openTab(event, 'queixa')">Queixa Principal</button>
                    <!-- <button type="button" class="tab-button" onclick="openTab(event, 'avaliacao')">Avaliação</button> -->
                </div>

                
                <section class="tab-content active" id="sinais">
                    <div class="form-row">
                        <div>
                            <label for="{{ form.temperatura.id_for_label }}">Temperatura:</label>
                            {{ form.temperatura }}
                        </div>
                        <div>
                            <label for="{{ form.pressao_sistolica.id_for_label }}">Pressão Arterial (SIS / DIA):</label>
                            <div class="pressao-container">
                                {{ form.pressao_sistolica }}
                                <span class="pressao-separator">/</span>
                                {{ form.pressao_diastolica }}
                            </div>
                        </div>
                        <div>
                            <label for="{{ form.pulso.id_for_label }}">Pulso:</label>
                            {{ form.pulso }}
                        </div>
                        <div>
                            <label for="{{ form.frequenciaRespiratoria.id_for_label }}">Frequência Respiratória:</label>
                            {{ form.frequenciaRespiratoria }}
                        </div>
                        <div>
                            <label for="{{ form.saturacao.id_for_label }}">Saturação:</label>
                            {{ form.saturacao }}
                        </div>
                        <div>
                            <label for="{{ form.pulso.id_for_label }}">Glicemia:</label>
                            {{ form.glicemia }}
                        </div>
                        <div>
                            <label for="{{ form.dor.id_for_label }}">Dor:</label>
                            {{ form.dor }}
                        </div>
                    </div>
                </section>

                
                <section class="tab-content" id="queixa">
                    <label for="{{ form.queixa.id_for_label }}">Queixa:</label>
                    {{ form.queixa }}

                    <label for="{{ form.sintomas_associados.id_for_label }}">Sintomas Associados:</label>
                    {{ form.sintomas_associados }}

                    <label for="{{ form.inicio_sintomas.id_for_label }}">Início dos Sintomas:</label>
                    {{ form.inicio_sintomas }}
                    
                    <label for="{{ form.observacoes.id_for_label }}">Observações:</label>
                    {{ form.observacoes }}
                </section>

                
                <!--<section class="tab-content" id="avaliacao">
                    <label for="{{ form.justificativa.id_for_label }}">Justificativa:</label>
                    {{ form.justificativa }}

                    <label for="{{ form.encaminhamento.id_for_label }}">Encaminhamento:</label>
                    {{ form.encaminhamento }}

                    <div class="form-row">
                        <div>python -m triagem.ml.train
                            <label for="{{ form.classificacao.id_for_label }}">Classificação:</label>
                            {{ form.classificacao }}
                        </div>
                        <div>
                            <label for="{{ form.status_atendimento.id_for_label }}">Status de Atendimento:</label>
                            {{ form.status_atendimento }}
                        </div>
                    </div>
                </section>-->
            </section>

            
        </div>

        <div class="botoes">
            <button type="button" id="btn-proximo" class="btn-enviar">Próximo</button>
            <button type="submit" id="btn-finalizar" class="btn-enviar">Finalizar Triagem</button>
        </div>
    </form>
</main>
{% endif %}
<script>
// Seleciona os botões que vamos manipular
const btnProximo = document.getElementById('btn-proximo');
const btnFinalizar = document.getElementById('btn-finalizar');
const tabQueixaBtn = document.getElementById('tab-btn-queixa');
const tabSinaisBtn = document.getElementById('tab-btn-sinais'); // <-- Adicionamos o botão da primeira aba

// Adiciona a funcionalidade ao botão "Próximo"
if (btnProximo && tabQueixaBtn) {
    btnProximo.addEventListener('click', () => {
        // Simula um clique na aba "Queixa Principal"
        tabQueixaBtn.click();
    });
}

// Função openTab ATUALIZADA
function openTab(evt, tabId) {
    // Esconde todas as seções de conteúdo
    const tabs = document.querySelectorAll('.tab-content');
    tabs.forEach(tab => tab.classList.remove('active'));

    // Desativa todos os botões de aba
    const buttons = document.querySelectorAll('.tab-button');
    buttons.forEach(btn => btn.classList.remove('active'));

    // Ativa a aba e o botão clicados
    document.getElementById(tabId).classList.add('active');
    evt.currentTarget.classList.add('active');

    // --- LÓGICA PARA CONTROLAR OS BOTÕES ---
    if (tabId === 'sinais') {
        btnProximo.classList.remove('hidden');
        btnFinalizar.classList.add('hidden');
    } else {
        btnProximo.classList.add('hidden');
        btnFinalizar.classList.remove('hidden');
    }
}

// --- LINHA MÁGICA ADICIONADA AQUI ---
// Simula um clique na aba inicial assim que a página carrega para definir o estado correto dos botões
if (tabSinaisBtn) {
    tabSinaisBtn.click();
}
</script>

<script src="{% static 'front/js/criar.js' %}?v=4"></script>

</body>
</html>
