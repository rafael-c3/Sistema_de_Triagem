{% extends 'site/headerBase.html' %}
{% load static %}

{% block title %}Meu Perfil - MedTriagem{% endblock %}

{% block styles %}
    <link rel="stylesheet" href="{% static 'front/css/perfil.css' %}?v=3">
{% endblock %}

{% block content %}

{% with usuario=perfil_usuario|default:user %}

<div class="profile-main-container">

    <a href="javascript:history.back()" class="btn-voltar">
        <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5"><path d="M19 12H5"></path><polyline points="12 19 5 12 12 5"></polyline></svg>
            <span>Voltar</span>
        
    </a>

    <h2>Perfil de Usu√°rio</h2>

    <div class="profile-content-wrapper">
        <aside class="profile-sidebar">
            <div class="profile-card">
                <div class="profile-avatar">
                    <svg xmlns="http://www.w3.org/2000/svg" width="64" height="64" fill="currentColor" class="bi bi-person-fill" viewBox="0 0 16 16">
                        <path d="M3 14s-1 0-1-1 1-4 6-4 6 3 6 4-1 1-1 1H3zm5-6a3 3 0 1 0 0-6 3 3 0 0 0 0 6z"/>
                    </svg>
                </div>
                <h3>Dr. {{ usuario.nome_completo }}</h3>
                <p class="username">@{{ usuario.username }}</p>
                <span class="user-role">{{ usuario.get_tipo_usuario_display }}</span>

                <ul class="profile-details">
                    <li>
                        <span class="icon">üë§</span>
                        <div>
                            <small>Nome Completo</small>
                            <p>{{ usuario.nome_completo }}</p>
                        </div>
                    </li>
                    <li>
                        <span class="icon">üìß</span>
                        <div>
                            <small>Email</small>
                            <p>{{ usuario.email }}</p>
                        </div>
                    </li>
                    <li>
                        <span class="icon">üí≥</span>
                        <div>
                            <small>CPF</small>
                            <p>{{ usuario.cpf }}</p>
                        </div>
                    </li>
                    <li>
                        <span class="icon">üè∑Ô∏è</span>
                        <div>
                            <small>Tipo de Conta</small>
                            <p>{{ usuario.get_tipo_usuario_display }}</p>
                        </div>
                    </li>
                    <li>
                        <span class="icon">üìÖ</span>
                        <div>
                            <small>Criado em</small>
                            <p>{{ usuario.date_joined|date:"d/m/Y" }}</p>
                        </div>
                    </li>
                </ul>

                <form action="{% url 'hosp:logout' %}" method="post" onsubmit="return confirm('Tem certeza que deseja sair da sua conta?');">
                    {% csrf_token %}
                    <button type="submit" class="logout-btn">
                        <span class="icon">‚Üí</span> Sair (Logout)
                    </button>
                </form>
            </div>
        </aside>

        <section class="profile-main-content">
            <div class="tabs-container">
                <button class="tab-button active" data-tab="historico">Hist√≥rico de Pacientes</button>
                <button class="tab-button" data-tab="feedbacks">Meus Feedbacks</button>
            </div>

            <div id="historico" class="tab-content active">
                <div class="content-card">
                    <h4>Pacientes Atendidos</h4>
                    <p>Hist√≥rico dos pacientes que voc√™ atendeu ou acompanhou</p>
                    <table>
                        <thead>
                            <tr>
                                <th>Nome do Paciente</th>
                                <th>Data de Chegada</th>
                                <th>Status</th>
                            </tr>
                        </thead>
                        <tbody>
                            {% for paciente in historico_pacientes %}
                            <tr>
                                <td><a href="{% url 'hosp:mostrar' pk=paciente.pk %}">{{ paciente.nome }}</a></td>
                                <td>üóìÔ∏è {{ paciente.hora_chegada|date:"d/m/Y" }}</td>
                                <td><span class="status-tag {{ paciente.status|slugify }}">{{ paciente.get_status_display }}</span></td>
                            </tr>
                            {% empty %}
                            <tr>
                                <td colspan="3">Nenhum paciente no hist√≥rico.</td>
                            </tr>
                            {% endfor %}
                        </tbody>
                    </table>
                </div>
            </div>

            <div id="feedbacks" class="tab-content">
                <div class="content-card">
                    <h4>Meus Feedbacks</h4>
                    <p>Avalia√ß√µes que voc√™ fez sobre as classifica√ß√µes de triagem</p>
                    <table>
                        <thead>
                            <tr>
                                <th>Paciente</th>
                                <th>Classifica√ß√£o Original</th>
                                <th>Minha Avalia√ß√£o</th>
                                <th>Data</th>
                            </tr>
                        </thead>
                        <tbody>
                            {% for feedback in feedbacks_do_usuario %}
                            <tr>
                                <td><a href="{% url 'hosp:mostrar' pk=feedback.paciente.pk %}">{{ feedback.paciente.nome }}</a></td>
                                <td><span class="tag {{ feedback.paciente.classificacao|slugify }}">{{ feedback.paciente.get_classificacao_display }}</span></td>

                                <td>
                                    {% if feedback.triagem_correta %}
                                        <span class="avaliacao correta">‚úîÔ∏è Correta</span>
                                    {% else %}
                                        <div class="avaliacao-wrapper">
                                            <span class="avaliacao incorreta">‚ùå Incorreta</span>
                                            <small>Sugest√£o: {{ feedback.get_classificacao_correta_display }}</small>
                                        </div>
                                    {% endif %}    
                                </td>
                                <td>üóìÔ∏è {{ feedback.data_criacao|date:"d/m/Y" }}</td>
                            </tr>
                            {% empty %}
                            <tr>
                                <td colspan="4">Nenhum feedback enviado.</td>
                            </tr>
                            {% endfor %}
                        </tbody>
                    </table>
                </div>
            </div>
        </section>
    </div>
</div>
{% endwith %}

{% endblock %}

{% block scripts %}
    <script src="{% static 'front/js/perfil.js' %}?v=4"></script>
{% endblock %}




</body>
</html>