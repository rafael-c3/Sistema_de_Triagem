{% extends 'site/loginBase.html' %}
{% load static %}

{% block body_class %}page-cadastro{% endblock %}

{% block title %}Cadastro de Usu√°rio{% endblock %}

{% block form_content %}
<div class="form-container registration-form">
    <h2 class="text-center">Criar Nova Conta</h2>
    <p class="subtitle text-center">Preencha os dados abaixo para se registrar no sistema</p>

    <form method="POST" novalidate>
        {% csrf_token %}

        <div class="form-section">
            <h3><i class="fas fa-user"></i> Informa√ß√µes Pessoais</h3>
            <div class="form-row">
                <div class="form-group col">
                    {{ form.nome_completo.label_tag }}
                    {{ form.nome_completo }}
                    {% for error in form.nome_completo.errors %}<div class="error-text">{{ error }}</div>{% endfor %}
                </div>
                <div class="form-group col">
                    {{ form.username.label_tag }}
                    {{ form.username }}
                    {% for error in form.username.errors %}<div class="error-text">{{ error }}</div>{% endfor %}
                </div>
            </div>
            <div class="form-row">
                <div class="form-group col">
                    {{ form.email.label_tag }}
                    {{ form.email }}
                    {% for error in form.email.errors %}<div class="error-text">{{ error }}</div>{% endfor %}
                </div>
                <div class="form-group col">
                    {{ form.cpf.label_tag }}
                    {{ form.cpf }}
                    {% for error in form.cpf.errors %}<div class="error-text">{{ error }}</div>{% endfor %}
                </div>
            </div>
        </div>
        <div class="form-section">
            <h3><i class="fas fa-shield-alt"></i> Tipo de Conta</h3>
            <div class="form-group">
                {{ form.tipo_usuario.label_tag }}
                {{ form.tipo_usuario }}
                {% for error in form.tipo_usuario.errors %}<div class="error-text">{{ error }}</div>{% endfor %}
            </div>
        </div> <div id="medico-fields-wrapper">
            <div class="form-row">
                <div class="form-group col">
                    {{ form.registro_profissional.label_tag }}
                    {{ form.registro_profissional }}
                    {% for error in form.registro_profissional.errors %}<div class="error-text">{{ error }}</div>{% endfor %}
                </div>
                <div class="form-group col">
                    {{ form.especializacao.label_tag }}
                    {{ form.especializacao }}
                    {% for error in form.especializacao.errors %}<div class="error-text">{{ error }}</div>{% endfor %}
                </div>
            </div>
        </div>


        <div class="form-section">
            <h3><i class="fas fa-lock"></i> Seguran√ßa</h3>
            <div class="form-row">
                <div class="form-group col">
                    {{ form.password1.label_tag }}
                    {{ form.password1 }}
                    {% for error in form.password1.errors %}<div class="error-text">{{ error }}</div>{% endfor %}
                </div>
                <div class="form-group col">
                    {{ form.password2.label_tag }}
                    {{ form.password2 }}
                    {% for error in form.password2.errors %}<div class="error-text">{{ error }}</div>{% endfor %}
                </div>
            </div>
            <div class="password-reqs">
                <p>Sua senha deve conter:</p>
                <ul>
                    <li><i class="fas fa-check-circle"></i> M√≠nimo de 8 caracteres</li>
                    <li><i class="fas fa-check-circle"></i> Pelo menos uma letra mai√∫scula</li>
                    <li><i class="fas fa-check-circle"></i> Pelo menos um n√∫mero</li>
                </ul>
            </div>
        </div>

        <div class="form-group agreement-checkbox">
            {{ form.terms_agreement }}
            {{ form.terms_agreement.label_tag }}
            {% for error in form.terms_agreement.errors %}<div class="error-text">{{ error }}</div>{% endfor %}
        </div>

        <button type="submit" class="btn-login">Criar Conta</button>

        <div class="divider">ou</div>

        <p class="text-center">
            J√° tem uma conta? <a href="{% url 'hosp:login' %}">Fa√ßa o login aqui</a>.
        </p>

    </form>
</div>

<div class="container mt-4">
    
    {% if dados_criados %}
    <div class="card border-success mb-4 shadow-sm">
        <div class="card-header bg-success text-white">
            <h5 class="mb-0">‚úÖ Usu√°rio Criado com Sucesso!</h5>
        </div>
        <div class="card-body bg-light">
            <p>Copie os dados abaixo e envie para o funcion√°rio:</p>
            
            <div class="alert alert-secondary" id="credenciais-box">
                <strong>Nome:</strong> {{ dados_criados.nome }}<br>
                <strong>Usu√°rio:</strong> <span id="copy-user">{{ dados_criados.usuario }}</span><br>
                <strong>E-mail:</strong> {{ dados_criados.email }}<br>
                <strong>Senha Tempor√°ria:</strong> <span id="copy-pass" class="text-danger fw-bold">{{ dados_criados.senha }}</span>
            </div>

            <button onclick="copiarDados()" class="btn btn-outline-dark btn-sm">
                üìã Copiar Tudo para √Årea de Transfer√™ncia
            </button>
            
            <hr>
            <p class="small text-muted mb-0">
                Aviso: O usu√°rio dever√° trocar essa senha no primeiro acesso.
            </p>
        </div>
    </div>
    {% endif %}

    <div class="card">
        <div class="card-header">
            <h3>Cadastrar Novo Funcion√°rio</h3>
        </div>
        <div class="card-body">
            <form method="POST">
                {% csrf_token %}
                {{ form.as_p }}
                <button type="submit" class="btn btn-primary w-100">Criar Usu√°rio</button>
            </form>
        </div>
    </div>
</div>

<script>
function copiarDados() {
    // Pega os dados
    var user = document.getElementById("copy-user").innerText;
    var pass = document.getElementById("copy-pass").innerText;
    
    // Monta o texto
    var texto = `Ol√°! Seu acesso ao sistema foi criado.\n\nUsu√°rio: ${user}\nSenha Tempor√°ria: ${pass}\n\nAcesse e troque sua senha imediatamente.`;
    
    // Copia para o clipboard
    navigator.clipboard.writeText(texto).then(function() {
        alert("Dados copiados! Agora √© s√≥ colar no WhatsApp ou E-mail.");
    }, function(err) {
        console.error('Erro ao copiar: ', err);
    });
}
</script>
{% endblock %}

{% block scripts %}
<script src="{% static 'front/js/cadastro.js' %}"></script>
{% endblock %}


    

    