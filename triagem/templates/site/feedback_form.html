{% extends 'site/headerBase.html' %}
{% load static %}

{% block title %}Feedback da Triagem - {{ paciente.nome }}{% endblock %}

{% block styles %}
    <link rel="stylesheet" href="{% static 'front/css/feedback.css' %}?v=3">
{% endblock %}

{% block content %}
<main class="feedback-container">
    <div class="feedback-header">
        <a class="btn-voltar" href="javascript:history.back()">
            <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5"><path d="M19 12H5"></path><polyline points="12 19 5 12 12 5"></polyline></svg>
            <span>Voltar</span>
        </a>
        <h2 class="header-title">Feedback da Triagem</h2>
    </div>

    <div class="feedback-grid">

        <div class="coluna-paciente">
            <aside class="patient-summary-card">
                <div class="summary-header">
                    <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M20 21v-2a4 4 0 0 0-4-4H8a4 4 0 0 0-4 4v2"></path><circle cx="12" cy="7" r="4"></circle></svg>
                    <h3>{{ paciente.nome }}</h3>
                </div>

                <p class="summary-id-cpf">ID: P-{{ paciente.id }} &bull; CPF: {{ paciente.cpf }}</p>

                <div class="summary-item summary-item-bordered">
                    <label>Classificação Original do Sistema</label>
                    <span class="tag {{ paciente.classificacao|lower }}">
                        {{ paciente.classificacao }} - {{ paciente.get_classificacao_display }}
                    </span>
                </div>
                <div class="summary-item">
                    <label>Data/Hora da Triagem</label>
                    <span><svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><circle cx="12" cy="12" r="10"></circle><polyline points="12 6 12 12 16 14"></polyline></svg> {{ paciente.hora_chegada|date:"d/m/Y \- H:i" }}</span>
                </div>
                <div class="summary-item">
                    <label>Responsavel pela Triagem</label>
                    <span>Enf. {{ paciente.atendente.nome_completo }}</span>
                </div>
            </aside>
            <a href="{% url 'hosp:mostrar' paciente.id %}" class="btn-prontuario">
                <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5" stroke-linecap="round" stroke-linejoin="round">
                    <path d="M14 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V8z"></path>
                    <polyline points="14 2 14 8 20 8"></polyline>
                    <line x1="16" y1="13" x2="8" y2="13"></line>
                    <line x1="16" y1="17" x2="8" y2="17"></line>
                </svg>
                <span>Ver Prontuário Completo</span>
            </a>
        </div>

        <div class="feedback-main-content">

            <div class="card">
                <div class="card-header-icon">
                    <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M21.5 12H16c-1.1-4.4-3.6-8-7-9.5M16 12a9 9 0 1 1-13 4.4M16 12v8c1.1 4.4 3.6 8 7 9.5M8 12a9 9 0 0 1 13-4.4M2.5 12H8c1.1 4.4 3.6 8 7 9.5M8 12V4c-1.1-4.4-3.6-8-7-9.5"></path></svg>
                    <h4>Resumo Clínico do Paciente</h4>
                </div>
                <div class="clinical-summary-grid">
                    <div><label>Queixa Principal</label><p>{{ paciente.queixa }}</p></div>
                    <div><label>Início dos Sintomas</label><p>{{ paciente.inicio_sintomas|date:"d/m/Y" }}</p></div>
                    <div><label>Sintomas Associados</label><p>{{ paciente.get_sintomas_associados_display }}</p></div>
                    <div><label>Observações do Triador</label><p>{{ paciente.observacoes|default:"Nenhuma." }}</p> </div>
                </div>

                <h4 class="sinais-vitais-title">Sinais Vitais Registrados</h4>

                <div class="sinais-vitais-grid-feedback">

                    <div class="vitais-main-grid">
                        <div class="vital-item-box vital-pressao">
                            <label>Pressão Arterial</label>
                            <span class="valor">{{ paciente.pressao_arterial }}</span>
                        </div>
                        <div class="vital-item-box vital-pulso">
                            <label>Pulso</label>
                            <span class="valor">{{ paciente.pulso }} bpm</span>
                        </div>
                        <div class="vital-item-box vital-temperatura">
                            <label>Temperatura</label>
                            <span class="valor">{{ paciente.temperatura }} °C</span>
                        </div>
                        <div class="vital-item-box vital-saturacao">
                            <label>Saturação O2</label>
                            <span class="valor">{{ paciente.saturacao }}%</span>
                        </div>
                        <div class="vital-item-box vital-glicemia">
                            <label>Glicemia</label>
                            <span class="valor">{{ paciente.glicemia }} mg/dL</span>
                        </div>
                        <div class="vital-item-box vital-respiratoria">
                            <label>Freq. Respiratória</label>
                            <span class="valor">{{ paciente.frequenciaRespiratoria }} rpm</span>
                        </div>
                    </div>

                    <div class="vital-item-box vital-item-dor-large vital-dor">
                        <label>Dor</label>
                        <span class="valor">{{ paciente.dor }}/10</span>
                    </div>
                </div>
            </div>

            <div class="card">
                <div class="card-header-icon">
                    <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M12 22h6a2 2 0 0 0 2-2V4a2 2 0 0 0-2-2H6a2 2 0 0 0-2 2v12c0 1.1.9 2 2 2h3v-2l3 3-3 3v-2z"></path><path d="M15 12v-2a2 2 0 0 0-2-2H7a2 2 0 0 0-2 2v2"></path><path d="M21 12h-2.5"></path><path d="M15 18h-2.5"></path><path d="M9 6v.01"></path></svg>
                    <h4>Avaliação do Profissional</h4>
                </div>
                <p class="form-description">Forneça seu feedback sobre a classificação de triagem realizada pelo sistema</p>

                <form method="post" class="feedback-form">
                    {% csrf_token %}

                    <div class="form-group">
                        <label class="form-group-title">A classificação do sistema estava correta?</label>
                        <div class="radio-group">
                            {% for radio in form.triagem_correta %}
                            <label for="{{ radio.id_for_label }}" class="radio-label">
                                {{ radio.tag }} 
                                <span class="custom-radio"></span>

                                {% if radio.choice_label == 'Sim, a classificação estava adequada.' %}
                                    <span class="icon-avaliacao icon-sim">
                                        <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="3" stroke-linecap="round" stroke-linejoin="round"><polyline points="20 6 9 17 4 12"></polyline></svg>
                                    </span>
                                {% elif radio.choice_label == 'Não, a classificação estava inadequada.' %}
                                    <span class="icon-avaliacao icon-nao">
                                        <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="3" stroke-linecap="round" stroke-linejoin="round"><line x1="18" y1="6" x2="6" y2="18"></line><line x1="6" y1="6" x2="18" y2="18"></line></svg>
                                    </span>
                                {% endif %}
                                <span class="radio-text">{{ radio.choice_label }}</span>
                            </label>
                            {% endfor %}
                        </div>
                    </div>

                    <div class="form-group" id="classificacao-sugerida-group">
                        <label for="{{ form.classificacao_correta.id_for_label }}" class="form-group-title">Qual classificação você sugeriria?</label>
                        {{ form.classificacao_correta }}
                    </div>

                    <div class="form-group">
                        <label for="{{ form.motivo.id_for_label }}" class="form-group-title">Justificativa da Avaliação</label>
                        {{ form.motivo }}
                    </div>

                    <div class="form-actions">
                        <a href="javascript:history.back()" class="btn-cancelar">Cancelar</a>
                        <button type="submit" class="btn-submit-feedback">Enviar Feedback</button>
                    </div>
                </form>
            </div>

        </div>
    </div>
</main>
{% endblock %}

{% block scripts %}
    <script src="{% static 'front/js/feedback.js' %}?v=4"></script>
{% endblock %}
</body>
</html>